cubes:
  - name: survey_form_question_answer
    sql_table: survey_form_question_answer
    joins:
      - name: survey_form_question_template
        sql: '{CUBE}.survey_form_question_template_id = {survey_form_question_template}.id'
        relationship: many_to_one
      - name: survey_form
        sql: '{CUBE}.survey_form_id = {survey_form}.id'
        relationship: many_to_one
    measures:
      - name: count
        type: count
    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true
      - name: surveyformid
        sql: '{CUBE}.survey_form_id'
        type: number
      - name: surveyformquestiontemplateid
        sql: '{CUBE}.survey_form_question_template_id'
        type: number
      - name: answer
        sql: '{CUBE}.answer'
        type: string
      - name: answer_type
        sql: '{CUBE}.answer ->> "type"'
        type: string
      - name: answer_value
        sql: |
          CASE
            WHEN {CUBE}.answer ->> 'type' IN ('SHORT_ANSWER', 'PARAGRAPH', 'NUMBER_SCALE', 'NUMERICAL', 'DATE', 'URL', 'EMAIL', 'PHONE')
              THEN {CUBE}.answer ->> 'value'
            WHEN {CUBE}.answer ->> 'type' IN ('SINGLE_SELECT', 'YES_NO')
              THEN {CUBE}.answer ->> 'selectedOption'
            WHEN {CUBE}.answer ->> 'type' = 'MULTIPLE_SELECT'
              THEN {CUBE}.answer ->> 'selectedOptions'
            WHEN {CUBE}.answer ->> 'type' = 'RATING'
              THEN {CUBE}.answer ->> 'rating'
            WHEN {CUBE}.answer ->> 'type' = 'FILE_UPLOAD'
              THEN ({CUBE}.answer -> 'files' -> 0 ->> 'fileUrl')
            ELSE NULL
          END
        type: string
      - name: createdat
        sql: '{CUBE}.created_at'
        type: time
      - name: updatedat
        sql: '{CUBE}.updated_at'
        type: time
